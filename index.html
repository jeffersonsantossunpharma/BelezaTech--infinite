
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BelezaTech Infinite - Gest√£o Inteligente de Sal√µes</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8B5CF6">
    <meta name="description" content="Sistema completo de gest√£o para sal√µes de beleza com IA integrada">
    <meta name="keywords" content="sal√£o, beleza, gest√£o, agendamento, pwa">
    <link rel="canonical" href="https://belezatech.vercel.app">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíá</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíá</text></svg>">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- QR Code Generator -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <style>
        :root {
            --primary-color: #8B5CF6;
            --secondary-color: #F3E8FF;
            --accent-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --dark-color: #1F2937;
            --light-color: #F9FAFB;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--secondary-color) 0%, #FFFFFF 100%);
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #6D28D9 100%);
            min-height: 100vh;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 2px 0;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateX(5px);
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), #7C3AED);
            color: white;
            border-radius: 12px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-day {
            background: white;
            padding: 12px;
            min-height: 100px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .calendar-day:hover {
            background: var(--secondary-color);
        }

        .appointment {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin: 2px 0;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .onboarding-step {
            display: none;
        }

        .onboarding-step.active {
            display: block;
        }

        .color-palette {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border-color 0.3s ease;
        }

        .color-option.selected {
            border-color: var(--primary-color);
        }

        .product-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }

        .client-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Chat Bot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
        }

        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), #7C3AED);
            border: none;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.6);
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.8); }
            100% { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4); }
        }

        .chatbot-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 1040;
        }

        .chatbot-header {
            background: linear-gradient(135deg, var(--primary-color), #7C3AED);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: between;
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .chat-message.bot {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message-bubble.user {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-bubble.bot {
            background: white;
            color: #333;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
        }

        .chatbot-input {
            padding: 15px 20px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 10px 15px;
            outline: none;
            font-size: 14px;
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .chat-suggestion {
            background: white;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-suggestion:hover {
            background: var(--primary-color);
            color: white;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            max-width: 80px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #666;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* PWA Install Prompt */
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 20px;
            display: none;
            z-index: 1030;
        }

        .pwa-install-prompt.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Time slots grid */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .time-slot {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .time-slot:hover {
            border-color: var(--primary-color);
            background: var(--secondary-color);
        }

        .time-slot.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .time-slot.disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
            border-color: #e5e5e5;
        }

        .time-slot.disabled:hover {
            background: #f5f5f5;
            border-color: #e5e5e5;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                position: fixed;
                z-index: 1000;
                width: 250px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0 !important;
            }

            .chatbot-window {
                width: calc(100vw - 20px);
                right: 10px;
                left: 10px;
                bottom: 90px;
            }

            .pwa-install-prompt {
                left: 10px;
                right: 10px;
            }
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f59e0b;
            color: white;
            text-align: center;
            padding: 10px;
            z-index: 9999;
            display: none;
        }

        .offline-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi-slash me-2"></i>
        Voc√™ est√° offline. Algumas funcionalidades podem estar limitadas.
    </div>

    <!-- PWA Install Prompt -->
    <div id="pwaInstallPrompt" class="pwa-install-prompt">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h6 class="mb-1">Instalar BelezaTech</h6>
                <small class="text-muted">Adicione √† tela inicial para acesso r√°pido</small>
            </div>
            <div>
                <button class="btn btn-outline-secondary btn-sm me-2" id="dismissInstall">Agora n√£o</button>
                <button class="btn btn-primary btn-sm" id="installPWA">Instalar</button>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <div class="chatbot-container">
        <button class="chatbot-toggle" id="chatbotToggle">
            <i class="fas fa-comments"></i>
        </button>
        
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Assistente IA</h6>
                        <small class="opacity-75">Online agora</small>
                    </div>
                </div>
                <button class="btn btn-link text-white p-0 ms-auto" id="closeChatbot">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chat-message bot">
                    <div class="message-bubble bot">
                        Ol√°! üëã Sou o assistente inteligente do BelezaTech. Como posso ajudar voc√™ hoje?
                    </div>
                </div>
                <div class="chat-suggestions" id="chatSuggestions">
                    <span class="chat-suggestion" data-suggestion="agendar">üìÖ Fazer agendamento</span>
                    <span class="chat-suggestion" data-suggestion="horarios">üïê Ver hor√°rios</span>
                    <span class="chat-suggestion" data-suggestion="servicos">üíá Nossos servi√ßos</span>
                    <span class="chat-suggestion" data-suggestion="historico">üìã Meu hist√≥rico</span>
                </div>
            </div>
            
            <div class="chatbot-input">
                <div class="chat-input-group">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem...">
                    <button class="chat-send-btn" id="chatSendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth/Login Screen -->
    <div id="authScreen" class="container-fluid vh-100 d-flex align-items-center justify-content-center">
        <div class="auth-container p-5" style="max-width: 400px; width: 100%;">
            <div class="text-center mb-4">
                <i class="fas fa-cut fa-3x text-primary mb-3"></i>
                <h2 class="fw-bold">BelezaTech Infinite</h2>
                <p class="text-muted">Gest√£o Inteligente de Sal√µes</p>
            </div>

            <form id="authForm">
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" placeholder="seu@email.com" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-control" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">
                    <span id="authButtonText">Entrar</span>
                    <i class="fas fa-spinner fa-spin d-none" id="authSpinner"></i>
                </button>
                <div class="text-center">
                    <a href="#" id="toggleAuth" class="text-decoration-none">N√£o tem conta? Cadastre-se</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Onboarding Screen -->
    <div id="onboardingScreen" class="container-fluid vh-100 d-flex align-items-center justify-content-center hidden">
        <div class="auth-container p-5" style="max-width: 600px; width: 100%;">
            <!-- Step 1: Informa√ß√µes do Sal√£o -->
            <div class="onboarding-step active" id="step1">
                <h3 class="mb-4">Configura√ß√£o do Sal√£o</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nome do Sal√£o</label>
                        <input type="text" class="form-control" id="salonName" placeholder="Beleza & Estilo">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-control" id="salonPhone" placeholder="(11) 99999-9999">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Endere√ßo</label>
                    <input type="text" class="form-control" id="salonAddress" placeholder="Rua das Flores, 123">
                </div>
                <div class="row">
                    <div class="col-6 mb-3">
                        <label class="form-label">Abertura</label>
                        <input type="time" class="form-control" id="openTime" value="08:00">
                    </div>
                    <div class="col-6 mb-3">
                        <label class="form-label">Fechamento</label>
                        <input type="time" class="form-control" id="closeTime" value="18:00">
                    </div>
                </div>
            </div>

            <!-- Step 2: Logo e Cores -->
            <div class="onboarding-step" id="step2">
                <h3 class="mb-4">Identidade Visual</h3>
                <div class="mb-4">
                    <label class="form-label">Logo do Sal√£o</label>
                    <input type="file" class="form-control" id="logoUpload" accept="image/*">
                    <div id="logoPreview" class="mt-3 text-center"></div>
                </div>
                <div class="mb-4">
                    <label class="form-label">Paleta de Cores</label>
                    <div class="color-palette" id="colorPalette">
                        <div class="color-option selected" style="background: #8B5CF6;" data-color="#8B5CF6"></div>
                        <div class="color-option" style="background: #EF4444;" data-color="#EF4444"></div>
                        <div class="color-option" style="background: #10B981;" data-color="#10B981"></div>
                        <div class="color-option" style="background: #F59E0B;" data-color="#F59E0B"></div>
                        <div class="color-option" style="background: #3B82F6;" data-color="#3B82F6"></div>
                        <div class="color-option" style="background: #8B5A2B;" data-color="#8B5A2B"></div>
                    </div>
                    <div class="mt-3">
                        <input type="color" class="form-control form-control-color" id="customColor" title="Cor personalizada">
                        <small class="text-muted">Ou escolha uma cor personalizada</small>
                    </div>
                </div>
                <div class="border rounded p-3" id="colorPreview">
                    <h5>Preview</h5>
                    <button class="btn btn-primary btn-sm">Bot√£o de Exemplo</button>
                    <div class="bg-light p-2 mt-2 rounded">
                        <small>Este √© um exemplo de como ficar√° sua interface</small>
                    </div>
                </div>
            </div>

            <!-- Step 3: Servi√ßos Iniciais -->
            <div class="onboarding-step" id="step3">
                <h3 class="mb-4">Servi√ßos do Sal√£o</h3>
                <div id="servicesList">
                    <div class="service-item border rounded p-3 mb-3">
                        <div class="row">
                            <div class="col-6">
                                <input type="text" class="form-control" placeholder="Nome do servi√ßo" value="Corte Feminino">
                            </div>
                            <div class="col-3">
                                <input type="number" class="form-control" placeholder="Pre√ßo" value="50">
                            </div>
                            <div class="col-3">
                                <input type="number" class="form-control" placeholder="Dura√ß√£o (min)" value="60">
                            </div>
                        </div>
                    </div>
                    <div class="service-item border rounded p-3 mb-3">
                        <div class="row">
                            <div class="col-6">
                                <input type="text" class="form-control" placeholder="Nome do servi√ßo" value="Escova">
                            </div>
                            <div class="col-3">
                                <input type="number" class="form-control" placeholder="Pre√ßo" value="30">
                            </div>
                            <div class="col-3">
                                <input type="number" class="form-control" placeholder="Dura√ß√£o (min)" value="45">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addService">
                    <i class="fas fa-plus"></i> Adicionar Servi√ßo
                </button>
            </div>

            <!-- Navigation Buttons -->
            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary" id="prevStep" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" class="btn btn-primary" id="nextStep">
                    Pr√≥ximo <i class="fas fa-arrow-right"></i>
                </button>
                <button type="button" class="btn btn-success" id="finishOnboarding" style="display: none;">
                    Finalizar <i class="fas fa-check"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardScreen" class="hidden">
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2">
                <div class="sidebar p-3">
                    <div class="text-center mb-4">
                        <img id="sidebarLogo" src="" alt="Logo" class="rounded mb-2" style="max-width: 80px; display: none;">
                        <h5 class="text-white" id="sidebarSalonName">BelezaTech</h5>
                    </div>
                    
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="fas fa-chart-line me-2"></i> Dashboard
                        </a>
                        <a class="nav-link" href="#" data-section="agenda">
                            <i class="fas fa-calendar-alt me-2"></i> Agenda
                        </a>
                        <a class="nav-link" href="#" data-section="clients">
                            <i class="fas fa-users me-2"></i> Clientes
                        </a>
                        <a class="nav-link" href="#" data-section="services">
                            <i class="fas fa-cut me-2"></i> Servi√ßos
                        </a>
                        <a class="nav-link" href="#" data-section="stock">
                            <i class="fas fa-boxes me-2"></i> Estoque
                        </a>
                        <a class="nav-link" href="#" data-section="payments">
                            <i class="fas fa-credit-card me-2"></i> Pagamentos
                        </a>
                        <a class="nav-link" href="#" data-section="public">
                            <i class="fas fa-globe me-2"></i> Portal P√∫blico
                        </a>
                    </nav>

                    <div class="mt-auto pt-4">
                        <button class="btn btn-outline-light btn-sm w-100" id="logoutBtn">
                            <i class="fas fa-sign-out-alt me-2"></i> Sair
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content p-4">
                    <!-- Dashboard Section -->
                    <div class="section active" id="dashboard-section">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Dashboard Executivo</h2>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary">
                                    <i class="fas fa-download"></i> Relat√≥rio
                                </button>
                                <button class="btn btn-primary" id="refreshDashboard">
                                    <i class="fas fa-sync"></i> Atualizar
                                </button>
                            </div>
                        </div>

                        <!-- KPIs -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card metric-card p-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-0" id="totalRevenue">R$ 0</h3>
                                            <small>Faturamento Mensal</small>
                                        </div>
                                        <i class="fas fa-dollar-sign fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card metric-card p-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-0" id="totalAppointments">0</h3>
                                            <small>Agendamentos do M√™s</small>
                                        </div>
                                        <i class="fas fa-calendar fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card metric-card p-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-0" id="totalClients">0</h3>
                                            <small>Clientes Cadastrados</small>
                                        </div>
                                        <i class="fas fa-users fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card metric-card p-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-0" id="todayAppointments">0</h3>
                                            <small>Agendamentos Hoje</small>
                                        </div>
                                        <i class="fas fa-clock fa-2x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts and Insights -->
                        <div class="row">
                            <div class="col-md-8 mb-4">
                                <div class="card p-4">
                                    <h5 class="mb-3">Faturamento dos √öltimos 7 Dias</h5>
                                    <canvas id="revenueChart" height="100"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="card p-4">
                                    <h5 class="mb-3">IA Insights</h5>
                                    <div id="aiInsights">
                                        <div class="alert alert-info">
                                            <i class="fas fa-robot me-2"></i>
                                            <strong>Insight do Gemini:</strong>
                                            <div id="aiInsightText">Carregando insights...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Today's Appointments -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Agendamentos de Hoje</h5>
                            </div>
                            <div class="card-body">
                                <div id="todayAppointmentsList">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agenda Section -->
                    <div class="section" id="agenda-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Agenda</h2>
                            <div class="d-flex gap-2">
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary active" data-view="month">M√™s</button>
                                    <button class="btn btn-outline-primary" data-view="week">Semana</button>
                                    <button class="btn btn-outline-primary" data-view="day">Dia</button>
                                </div>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#appointmentModal">
                                    <i class="fas fa-plus"></i> Novo Agendamento
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <div id="calendar">
                                    <!-- Calendar will be generated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Clients Section -->
                    <div class="section" id="clients-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Gest√£o de Clientes</h2>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#clientModal">
                                <i class="fas fa-plus"></i> Novo Cliente
                            </button>
                        </div>

                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="clientSearch" placeholder="Buscar cliente...">
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="clientFilter">
                                            <option value="">Todos os clientes</option>
                                            <option value="active">Ativos</option>
                                            <option value="inactive">Inativos</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-primary w-100" id="exportClients">
                                            <i class="fas fa-download"></i> Exportar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row" id="clientsList">
                            <!-- Dynamic client cards -->
                        </div>
                    </div>

                    <!-- Services Section -->
                    <div class="section" id="services-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Gest√£o de Servi√ßos</h2>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#serviceModal">
                                <i class="fas fa-plus"></i> Novo Servi√ßo
                            </button>
                        </div>

                        <div class="row" id="servicesList">
                            <!-- Dynamic service cards -->
                        </div>
                    </div>

                    <!-- Stock Section -->
                    <div class="section" id="stock-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Estoque Inteligente</h2>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary" id="scanBarcode">
                                    <i class="fas fa-camera"></i> Escanear C√≥digo
                                </button>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal">
                                    <i class="fas fa-plus"></i> Novo Produto
                                </button>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <input type="text" class="form-control" id="productSearch" placeholder="Buscar produto...">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" id="categoryFilter">
                                            <option value="">Todas as categorias</option>
                                            <option value="shampoo">Shampoo</option>
                                            <option value="conditioner">Condicionador</option>
                                            <option value="coloracao">Colora√ß√£o</option>
                                            <option value="tratamento">Tratamento</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="productsList">
                            <!-- Dynamic product cards -->
                        </div>
                    </div>

                    <!-- Payments Section -->
                    <div class="section" id="payments-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Su√≠te de Pagamentos</h2>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary" id="generatePaymentLink">
                                    <i class="fas fa-link"></i> Gerar Link
                                </button>
                                <button class="btn btn-primary" id="generateQRCode">
                                    <i class="fas fa-qrcode"></i> Gerar QR Code
                                </button>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card p-3">
                                    <h6>Faturamento Hoje</h6>
                                    <h3 class="text-success" id="todayRevenue">R$ 0,00</h3>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card p-3">
                                    <h6>Pagamentos Pendentes</h6>
                                    <h3 class="text-warning" id="pendingPayments">R$ 0,00</h3>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card p-3">
                                    <h6>Total do M√™s</h6>
                                    <h3 class="text-primary" id="monthRevenue">R$ 0,00</h3>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Hist√≥rico de Transa√ß√µes</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Cliente</th>
                                                <th>Servi√ßo</th>
                                                <th>Valor</th>
                                                <th>Status</th>
                                                <th>A√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transactionsTable">
                                            <!-- Dynamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Public Portal Section -->
                    <div class="section" id="public-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="fw-bold">Portal P√∫blico</h2>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary" id="copyPublicLink">
                                    <i class="fas fa-copy"></i> Copiar Link
                                </button>
                                <button class="btn btn-primary" id="previewPublicPortal">
                                    <i class="fas fa-eye"></i> Visualizar
                                </button>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">Configura√ß√µes do Portal</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enableBooking" checked>
                                            <label class="form-check-label" for="enableBooking">
                                                Permitir agendamentos online
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="requirePayment">
                                            <label class="form-check-label" for="requirePayment">
                                                Exigir pagamento antecipado
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Link do Portal P√∫blico</h6>
                            </div>
                            <div class="card-body">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="publicPortalLink" readonly 
                                           value="https://belezatech.vercel.app/salon/demo">
                                    <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('publicPortalLink')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <small class="text-muted">Compartilhe este link com seus clientes para permitir agendamentos online</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Public Portal (for clients) -->
    <div id="publicPortal" class="hidden">
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <img id="publicLogo" src="" alt="Logo" style="height: 40px; display: none;">
                    <span id="publicSalonName">Sal√£o de Beleza</span>
                </a>
            </div>
        </nav>

        <div class="container my-5">
            <div class="row">
                <div class="col-md-8 mx-auto">
                    <div class="card">
                        <div class="card-header text-center">
                            <h4>Agendar Servi√ßo</h4>
                        </div>
                        <div class="card-body">
                            <form id="publicBookingForm">
                                <div class="mb-3">
                                    <label class="form-label">Selecione o Servi√ßo</label>
                                    <select class="form-select" id="publicServiceSelect" required>
                                        <option value="">Escolha um servi√ßo...</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Data</label>
                                    <input type="date" class="form-control" id="publicBookingDate" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Hor√°rio Dispon√≠vel</label>
                                    <div class="time-slots" id="publicTimeSlots">
                                        <!-- Time slots will be generated here -->
                                    </div>
                                    <input type="hidden" id="selectedTimeSlot">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="publicClientName" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">WhatsApp</label>
                                    <input type="tel" class="form-control" id="publicClientPhone" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="publicClientEmail">
                                </div>
                                
                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        Confirmar Agendamento
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Appointment Modal -->
    <div class="modal fade" id="appointmentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Agendamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="appointmentForm">
                        <div class="mb-3">
                            <label class="form-label">Cliente</label>
                            <select class="form-select" id="appointmentClient" required>
                                <option value="">Selecione um cliente...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Servi√ßo</label>
                            <select class="form-select" id="appointmentService" required>
                                <option value="">Selecione um servi√ßo...</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Data</label>
                                <input type="date" class="form-control" id="appointmentDate" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Hor√°rio</label>
                                <input type="time" class="form-control" id="appointmentTime" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Observa√ß√µes</label>
                            <textarea class="form-control" id="appointmentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveAppointment">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Modal -->
    <div class="modal fade" id="clientModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="clientForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nome Completo</label>
                                <input type="text" class="form-control" id="clientName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">WhatsApp</label>
                                <input type="tel" class="form-control" id="clientPhone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="clientEmail">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Data de Nascimento</label>
                                <input type="date" class="form-control" id="clientBirthdate">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Anota√ß√µes T√©cnicas</label>
                            <textarea class="form-control" id="clientNotes" rows="3" 
                                     placeholder="F√≥rmulas, prefer√™ncias, alergias, etc."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveClient">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal fade" id="serviceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Servi√ßo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="serviceForm">
                        <div class="mb-3">
                            <label class="form-label">Nome do Servi√ßo</label>
                            <input type="text" class="form-control" id="serviceName" required>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Pre√ßo (R$)</label>
                                <input type="number" class="form-control" id="servicePrice" step="0.01" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Dura√ß√£o (min)</label>
                                <input type="number" class="form-control" id="serviceDuration" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descri√ß√£o</label>
                            <textarea class="form-control" id="serviceDescription" rows="3"></textarea>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="serviceActive" checked>
                            <label class="form-check-label" for="serviceActive">
                                Dispon√≠vel para agendamento online
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveService">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Produto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="mb-3">
                            <label class="form-label">Nome do Produto</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Categoria</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Selecione...</option>
                                    <option value="shampoo">Shampoo</option>
                                    <option value="conditioner">Condicionador</option>
                                    <option value="coloracao">Colora√ß√£o</option>
                                    <option value="tratamento">Tratamento</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Quantidade</label>
                                <input type="number" class="form-control" id="productQuantity" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">C√≥digo de Barras</label>
                            <input type="text" class="form-control" id="productBarcode">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descri√ß√£o (ser√° gerada pela IA)</label>
                            <textarea class="form-control" id="productDescription" rows="3" readonly></textarea>
                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="generateDescription">
                                <i class="fas fa-robot"></i> Gerar com IA
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveProduct">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // PWA Manifest JSON (inline)
        const manifest = {
            "name": "BelezaTech Infinite",
            "short_name": "BelezaTech",
            "description": "Sistema completo de gest√£o para sal√µes de beleza",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#8B5CF6",
            "theme_color": "#8B5CF6",
            "orientation": "portrait-primary",
            "icons": [
                {
                    "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíá</text></svg>",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                },
                {
                    "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíá</text></svg>",
                    "sizes": "512x512",
                    "type": "image/svg+xml"
                }
            ]
        };

        // Service Worker (inline)
        const serviceWorkerCode = `
            const CACHE_NAME = 'belezatech-v1';
            const urlsToCache = [
                '/',
                'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                'https://cdn.jsdelivr.net/npm/chart.js',
                'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
            ];

            self.addEventListener('install', function(event) {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(function(cache) {
                            return cache.addAll(urlsToCache);
                        })
                );
            });

            self.addEventListener('fetch', function(event) {
                event.respondWith(
                    caches.match(event.request)
                        .then(function(response) {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        }
                    )
                );
            });

            self.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'SKIP_WAITING') {
                    self.skipWaiting();
                }
            });
        `;

        // Global variables
        let currentUser = null;
        let currentSalon = null;
        let supabase = null;
        let currentStep = 1;
        let selectedColor = '#8B5CF6';
        let deferredPrompt = null;
        let chatHistory = [];

        // Initialize Supabase (you'll need to replace with your actual URL and key)
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        
        // For demo purposes, we'll use localStorage to simulate backend
        const DEMO_MODE = true;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (!DEMO_MODE) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
            
            initializePWA();
            initializeApp();
            initializeChatbot();
            setupNetworkDetection();
        });

        // PWA Functions
        function initializePWA() {
            // Register manifest
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestURL = URL.createObjectURL(manifestBlob);
            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = manifestURL;
            document.head.appendChild(link);

            // Register service worker
            if ('serviceWorker' in navigator) {
                const swBlob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(swBlob);
                
                navigator.serviceWorker.register(swURL)
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            }

            // Listen for install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallPrompt();
            });

            // Setup install prompt handlers
            document.getElementById('installPWA').addEventListener('click', installPWA);
            document.getElementById('dismissInstall').addEventListener('click', dismissInstall);
        }

        function showInstallPrompt() {
            const prompt = document.getElementById('pwaInstallPrompt');
            prompt.classList.add('show');
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            const prompt = document.getElementById('pwaInstallPrompt');
            prompt.classList.remove('show');
        }

        function setupNetworkDetection() {
            const offlineIndicator = document.getElementById('offlineIndicator');
            
            function updateOnlineStatus() {
                if (!navigator.onLine) {
                    offlineIndicator.classList.add('show');
                } else {
                    offlineIndicator.classList.remove('show');
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus(); // Check initial status
        }

        // Chatbot Functions
        function initializeChatbot() {
            const toggle = document.getElementById('chatbotToggle');
            const window = document.getElementById('chatbotWindow');
            const close = document.getElementById('closeChatbot');
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSendBtn');
            const suggestions = document.getElementById('chatSuggestions');

            toggle.addEventListener('click', () => {
                window.style.display = window.style.display === 'flex' ? 'none' : 'flex';
            });

            close.addEventListener('click', () => {
                window.style.display = 'none';
            });

            sendBtn.addEventListener('click', sendChatMessage);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // Handle suggestion clicks
            suggestions.addEventListener('click', (e) => {
                if (e.target.classList.contains('chat-suggestion')) {
                    const suggestion = e.target.dataset.suggestion;
                    handleChatSuggestion(suggestion);
                }
            });

            // Initialize with welcome message
            chatHistory = [
                {
                    type: 'bot',
                    message: 'Ol√°! üëã Sou o assistente inteligente do BelezaTech. Como posso ajudar voc√™ hoje?',
                    timestamp: new Date()
                }
            ];
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage('user', message);
                input.value = '';
                
                // Process message with AI
                processChatMessage(message);
            }
        }

        function addChatMessage(type, message) {
            const container = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            messageDiv.innerHTML = `
                <div class="message-bubble ${type}">
                    ${message}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // Add to history
            chatHistory.push({
                type: type,
                message: message,
                timestamp: new Date()
            });
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatbotMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message bot typing-message';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
            
            return typingDiv;
        }

        function removeTypingIndicator(typingDiv) {
            if (typingDiv && typingDiv.parentNode) {
                typingDiv.parentNode.removeChild(typingDiv);
            }
        }

        async function processChatMessage(message) {
            const typingIndicator = showTypingIndicator();
            
            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
            
            removeTypingIndicator(typingIndicator);
            
            const response = generateChatResponse(message);
            addChatMessage('bot', response);
        }

        function generateChatResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Intent detection with patterns
            if (lowerMessage.includes('agendar') || lowerMessage.includes('agendamento') || lowerMessage.includes('marcar')) {
                return `üìÖ Claro! Posso te ajudar com o agendamento. 

Para fazer um agendamento, voc√™ precisa:
1. Escolher o servi√ßo desejado
2. Selecionar data e hor√°rio
3. Confirmar seus dados

Gostaria de ver nossos servi√ßos dispon√≠veis? Temos:
‚Ä¢ Corte Feminino (R$ 50 - 60min)
‚Ä¢ Corte Masculino (R$ 30 - 30min)  
‚Ä¢ Escova (R$ 35 - 45min)
‚Ä¢ Hidrata√ß√£o (R$ 45 - 60min)
‚Ä¢ Colora√ß√£o (R$ 120 - 120min)

Digite o nome do servi√ßo que deseja agendar! üíá‚Äç‚ôÄÔ∏è`;
            }
            
            if (lowerMessage.includes('hor√°rio') || lowerMessage.includes('horarios') || lowerMessage.includes('dispon√≠vel')) {
                return `üïê Nossos hor√°rios de funcionamento:
                
**Segunda a Sexta:** 08:00 √†s 18:00
**S√°bado:** 08:00 √†s 17:00
**Domingo:** Fechado

Para hoje (${new Date().toLocaleDateString('pt-BR')}), temos os seguintes hor√°rios dispon√≠veis:
‚Ä¢ 09:00 ‚úÖ
‚Ä¢ 11:00 ‚úÖ  
‚Ä¢ 14:00 ‚úÖ
‚Ä¢ 16:00 ‚úÖ

Qual hor√°rio voc√™ prefere? Posso fazer a reserva para voc√™! üòä`;
            }
            
            if (lowerMessage.includes('servi√ßo') || lowerMessage.includes('servicos') || lowerMessage.includes('pre√ßo') || lowerMessage.includes('valor')) {
                return `üíá‚Äç‚ôÄÔ∏è **Nossos Servi√ßos:**

**CORTES**
‚Ä¢ Corte Feminino - R$ 50,00 (60min)
‚Ä¢ Corte Masculino - R$ 30,00 (30min)
‚Ä¢ Corte Infantil - R$ 25,00 (30min)

**CABELOS**
‚Ä¢ Escova - R$ 35,00 (45min)
‚Ä¢ Hidrata√ß√£o - R$ 45,00 (60min)
‚Ä¢ Colora√ß√£o Completa - R$ 120,00 (120min)
‚Ä¢ Mechas - R$ 80,00 (90min)

**EST√âTICA**
‚Ä¢ Manicure - R$ 25,00 (45min)
‚Ä¢ Pedicure - R$ 30,00 (60min)
‚Ä¢ Design de Sobrancelhas - R$ 20,00 (30min)

Qual servi√ßo te interessa? Posso agendar para voc√™! ‚ú®`;
            }
            
            if (lowerMessage.includes('hist√≥rico') || lowerMessage.includes('historico') || lowerMessage.includes('consulta')) {
                return `üìã Para consultar seu hist√≥rico, preciso do seu n√∫mero de telefone ou email.

Com essas informa√ß√µes posso mostrar:
‚Ä¢ √öltimos agendamentos
‚Ä¢ Servi√ßos realizados
‚Ä¢ Valores pagos
‚Ä¢ Pr√≥ximos agendamentos

Por favor, informe seu telefone (ex: 11999999999) ou email para buscar seu hist√≥rico! üì±`;
            }
            
            if (lowerMessage.includes('cancelar') || lowerMessage.includes('desmarcar')) {
                return `‚ùå **Cancelamento de Agendamento**

Para cancelar um agendamento, preciso:
1. Seu telefone ou email
2. Data do agendamento
3. Hor√°rio marcado

‚ö†Ô∏è **Pol√≠tica de Cancelamento:**
‚Ä¢ At√© 2h antes: Cancelamento gratuito
‚Ä¢ Menos de 2h: Taxa de 50% do valor
‚Ä¢ N√£o comparecimento: Taxa de 100%

Tem algum agendamento que gostaria de cancelar? Me informe os dados! üìû`;
            }
            
            if (lowerMessage.includes('localiza√ß√£o') || lowerMessage.includes('endere√ßo') || lowerMessage.includes('onde fica')) {
                const salon = currentSalon || { name: 'Sal√£o de Beleza', address: 'Rua das Flores, 123 - Centro' };
                return `üìç **Localiza√ß√£o do ${salon.name}:**

${salon.address}

**Como Chegar:**
‚Ä¢ üöå Transporte p√∫blico: Linhas 123, 456
‚Ä¢ üöó De carro: Estacionamento gratuito
‚Ä¢ üö∂‚Äç‚ôÄÔ∏è A p√©: Pr√≥ximo ao metr√¥ Central

**Refer√™ncias:**
‚Ä¢ Em frente √† farm√°cia
‚Ä¢ Ao lado do banco
‚Ä¢ Pr√©dio comercial azul

Precisa de mais informa√ß√µes sobre como chegar? üó∫Ô∏è`;
            }
            
            if (lowerMessage.includes('pre√ßo') || lowerMessage.includes('quanto custa') || lowerMessage.includes('valor')) {
                return `üí∞ **Nossos Pre√ßos:**

**Mais Procurados:**
‚Ä¢ Corte + Escova Feminino: R$ 75,00
‚Ä¢ Corte Masculino: R$ 30,00
‚Ä¢ Hidrata√ß√£o Completa: R$ 65,00

**Combos Promocionais:**
‚Ä¢ Corte + Escova + Hidrata√ß√£o: R$ 110,00 (Economia de R$ 20)
‚Ä¢ Manicure + Pedicure: R$ 45,00 (Economia de R$ 10)

**Formas de Pagamento:**
‚Ä¢ üí≥ Cart√£o (d√©bito/cr√©dito)
‚Ä¢ üí∞ Dinheiro (5% desconto)
‚Ä¢ üì± Pix (3% desconto)

Qual servi√ßo voc√™ tem interesse? Posso fazer um or√ßamento personalizado! üéØ`;
            }
            
            if (lowerMessage.includes('promo√ß√£o') || lowerMessage.includes('desconto') || lowerMessage.includes('oferta')) {
                return `üéâ **Promo√ß√µes Ativas:**

**Primeira Visita:**
‚Ä¢ 20% OFF em qualquer servi√ßo
‚Ä¢ V√°lido at√© ${new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString('pt-BR')}

**Combo da Semana:**
‚Ä¢ Corte + Escova + Hidrata√ß√£o: R$ 110,00
‚Ä¢ Economia de R$ 20,00!

**Cliente Fiel:**
‚Ä¢ A cada 5 visitas, ganhe 50% OFF na pr√≥xima
‚Ä¢ V√°lido para qualquer servi√ßo

**Indique e Ganhe:**
‚Ä¢ Indique um amigo e ganhe R$ 15,00 de desconto
‚Ä¢ Sem limite de indica√ß√µes!

Gostaria de aproveitar alguma promo√ß√£o? üõçÔ∏è`;
            }
            
            // Respostas de contexto espec√≠fico
            if (lowerMessage.includes('corte feminino')) {
                return `‚úÇÔ∏è **Corte Feminino - R$ 50,00**

**Inclui:**
‚Ä¢ Lavagem com shampoo profissional
‚Ä¢ Corte personalizado para seu rosto
‚Ä¢ Finaliza√ß√£o com escova
‚Ä¢ Dicas de cuidados

**Dura√ß√£o:** 60 minutos
**Profissionais:** Todas nossas cabeleireiras

Hor√°rios dispon√≠veis hoje:
‚Ä¢ 09:00 ‚úÖ ‚Ä¢ 11:00 ‚úÖ ‚Ä¢ 14:00 ‚úÖ ‚Ä¢ 16:00 ‚úÖ

Gostaria de agendar? Digite "agendar corte feminino [hor√°rio]"! üíá‚Äç‚ôÄÔ∏è`;
            }

            // Padr√£o de reconhecimento de telefone
            if (/\d{10,11}/.test(message.replace(/\D/g, ''))) {
                const phone = message.replace(/\D/g, '');
                return `üì± Encontrei o telefone: ${phone}

Buscando seu hist√≥rico... üîç

**Cliente:** Maria Silva
**√öltima visita:** 15/01/2024
**Servi√ßos realizados:**
‚Ä¢ Corte Feminino (R$ 50,00) - 15/01
‚Ä¢ Hidrata√ß√£o (R$ 45,00) - 28/12
‚Ä¢ Escova (R$ 35,00) - 10/12

**Pr√≥ximo agendamento:**
‚Ä¢ Nenhum agendamento marcado

Gostaria de agendar um novo servi√ßo? üìÖ`;
            }

            // Padr√£o de reconhecimento de email
            if (lowerMessage.includes('@') && lowerMessage.includes('.')) {
                return `üìß Email registrado encontrado!

**Hist√≥rico de Servi√ßos:**
‚Ä¢ Total de visitas: 8
‚Ä¢ Valor total investido: R$ 420,00
‚Ä¢ Servi√ßo favorito: Corte + Escova

**Status:** Cliente VIP üåü
**Desconto dispon√≠vel:** 15%

**√öltimos agendamentos:**
‚Ä¢ 15/01 - Corte Feminino ‚úÖ
‚Ä¢ 28/12 - Hidrata√ß√£o ‚úÖ  
‚Ä¢ 10/12 - Escova ‚úÖ

Quer agendar um novo servi√ßo com seu desconto VIP? üëë`;
            }

            // Respostas para sauda√ß√µes
            if (lowerMessage.includes('oi') || lowerMessage.includes('ol√°') || lowerMessage.includes('bom dia') || lowerMessage.includes('boa tarde')) {
                return `Ol√°! üòä Seja muito bem-vindo(a) ao ${currentSalon?.name || 'BelezaTech'}!

Sou sua assistente virtual e estou aqui para ajudar com:
‚Ä¢ üìÖ Agendamentos
‚Ä¢ üïê Consulta de hor√°rios  
‚Ä¢ üíá‚Äç‚ôÄÔ∏è Informa√ß√µes sobre servi√ßos
‚Ä¢ üìã Hist√≥rico de atendimentos
‚Ä¢ üìç Localiza√ß√£o e contato

Como posso te ajudar hoje? Digite uma das op√ß√µes ou me fale o que precisa! ‚ú®`;
            }

            // Resposta padr√£o inteligente
            return `ü§ñ Entendi que voc√™ est√° perguntando sobre "${message}".

**Posso te ajudar com:**
‚Ä¢ üìÖ **"agendar"** - Para fazer agendamentos
‚Ä¢ üïê **"hor√°rios"** - Ver disponibilidade  
‚Ä¢ üíá‚Äç‚ôÄÔ∏è **"servi√ßos"** - Lista completa e pre√ßos
‚Ä¢ üìã **"hist√≥rico"** - Consultar atendimentos
‚Ä¢ üìç **"endere√ßo"** - Localiza√ß√£o do sal√£o
‚Ä¢ üéâ **"promo√ß√µes"** - Ofertas e descontos

Ou digite seu telefone/email para buscar informa√ß√µes espec√≠ficas!

Como posso ajudar voc√™ melhor? üòä`;
        }

        function handleChatSuggestion(suggestion) {
            const suggestions = {
                'agendar': 'Gostaria de fazer um agendamento',
                'horarios': 'Quais s√£o os hor√°rios dispon√≠veis?',
                'servicos': 'Quais servi√ßos voc√™s oferecem?',
                'historico': 'Gostaria de consultar meu hist√≥rico'
            };
            
            const message = suggestions[suggestion];
            if (message) {
                addChatMessage('user', message);
                processChatMessage(message);
            }
        }

        function initializeApp() {
            // Check if user is already logged in
            const user = localStorage.getItem('belezatech_user');
            if (user) {
                const userData = JSON.parse(user);
                currentUser = userData;
                
                // Check if onboarding is complete
                const salon = localStorage.getItem('belezatech_salon');
                if (salon) {
                    currentSalon = JSON.parse(salon);
                    showDashboard();
                } else {
                    showOnboarding();
                }
            } else {
                showAuth();
            }

            setupEventListeners();
        }

        function setupEventListeners() {
            // Auth form
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            document.getElementById('toggleAuth').addEventListener('click', toggleAuthMode);

            // Onboarding
            document.getElementById('nextStep').addEventListener('click', nextOnboardingStep);
            document.getElementById('prevStep').addEventListener('click', prevOnboardingStep);
            document.getElementById('finishOnboarding').addEventListener('click', finishOnboarding);
            document.getElementById('logoUpload').addEventListener('change', handleLogoUpload);
            document.getElementById('addService').addEventListener('click', addServiceRow);

            // Color palette
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', selectColor);
            });
            document.getElementById('customColor').addEventListener('change', handleCustomColor);

            // Navigation
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', handleNavigation);
            });

            // Dashboard
            document.getElementById('refreshDashboard').addEventListener('click', refreshDashboard);

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Modals
            document.getElementById('saveAppointment').addEventListener('click', saveAppointment);
            document.getElementById('saveClient').addEventListener('click', saveClient);
            document.getElementById('saveService').addEventListener('click', saveService);
            document.getElementById('saveProduct').addEventListener('click', saveProduct);

            // AI features
            document.getElementById('generateDescription').addEventListener('click', generateProductDescription);

            // Public portal
            document.getElementById('copyPublicLink').addEventListener('click', copyPublicLink);
            document.getElementById('previewPublicPortal').addEventListener('click', previewPublicPortal);

            // Public booking form
            document.getElementById('publicBookingForm').addEventListener('submit', handlePublicBooking);
            document.getElementById('publicBookingDate').addEventListener('change', loadAvailableTimeSlots);
            document.getElementById('publicServiceSelect').addEventListener('change', loadAvailableTimeSlots);
        }

        // Public Portal Time Slots Fix
        function loadAvailableTimeSlots() {
            const date = document.getElementById('publicBookingDate').value;
            const serviceId = document.getElementById('publicServiceSelect').value;
            const container = document.getElementById('publicTimeSlots');
            
            if (!date || !serviceId) {
                container.innerHTML = '<p class="text-muted">Selecione um servi√ßo e data primeiro</p>';
                return;
            }
            
            // Get salon hours
            const salon = currentSalon || { open_time: '08:00', close_time: '18:00' };
            const openTime = salon.open_time || '08:00';
            const closeTime = salon.close_time || '18:00';
            
            // Get service duration
            const services = JSON.parse(localStorage.getItem('belezatech_services') || '[]');
            const service = services.find(s => s.id == serviceId);
            const duration = service ? service.duration : 60;
            
            // Generate time slots
            const slots = generateTimeSlots(openTime, closeTime, duration, date);
            
            if (slots.length === 0) {
                container.innerHTML = '<p class="text-muted">Nenhum hor√°rio dispon√≠vel para esta data</p>';
                return;
            }
            
            container.innerHTML = slots.map(slot => `
                <div class="time-slot ${slot.available ? '' : 'disabled'}" 
                     data-time="${slot.time}" 
                     onclick="selectTimeSlot(this, '${slot.time}')">
                    ${slot.time}
                </div>
            `).join('');
        }

        function generateTimeSlots(openTime, closeTime, serviceDuration, date) {
            const slots = [];
            const [openHour, openMinute] = openTime.split(':').map(Number);
            const [closeHour, closeMinute] = closeTime.split(':').map(Number);
            
            const startTime = openHour * 60 + openMinute; // Convert to minutes
            const endTime = closeHour * 60 + closeMinute;
            
            // Get existing appointments for the date
            const appointments = JSON.parse(localStorage.getItem('belezatech_appointments') || '[]');
            const dayAppointments = appointments.filter(apt => apt.date === date);
            
            for (let time = startTime; time + serviceDuration <= endTime; time += 30) { // 30-minute intervals
                const hour = Math.floor(time / 60);
                const minute = time % 60;
                const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                
                // Check if this time slot is available
                const isAvailable = !dayAppointments.some(apt => {
                    const aptTime = apt.time;
                    const aptHour = parseInt(aptTime.split(':')[0]);
                    const aptMinute = parseInt(aptTime.split(':')[1]);
                    const aptStart = aptHour * 60 + aptMinute;
                    
                    return (time >= aptStart && time < aptStart + serviceDuration) ||
                           (aptStart >= time && aptStart < time + serviceDuration);
                });
                
                // Don't show past times for today
                const selectedDate = new Date(date);
                const today = new Date();
                const now = new Date();
                
                let available = isAvailable;
                if (selectedDate.toDateString() === today.toDateString()) {
                    const currentTime = now.getHours() * 60 + now.getMinutes();
                    available = available && time > currentTime;
                }
                
                slots.push({
                    time: timeString,
                    available: available
                });
            }
            
            return slots;
        }

        function selectTimeSlot(element, time) {
            if (element.classList.contains('disabled')) return;
            
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Select current
            element.classList.add('selected');
            document.getElementById('selectedTimeSlot').value = time;
        }

        // Authentication functions
        function showAuth() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('onboardingScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('publicPortal').classList.add('hidden');
        }

        function showOnboarding() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('onboardingScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('publicPortal').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('onboardingScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
            document.getElementById('publicPortal').classList.add('hidden');
            
            // Load salon data into sidebar
            if (currentSalon) {
                document.getElementById('sidebarSalonName').textContent = currentSalon.name;
                if (currentSalon.logo) {
                    const logoImg = document.getElementById('sidebarLogo');
                    logoImg.src = currentSalon.logo;
                    logoImg.style.display = 'block';
                }
                
                // Apply salon colors
                applyBrandColors(currentSalon.primaryColor || currentSalon.primary_color);
            }
            
            loadDashboardData();
        }

        function showPublicPortal() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('onboardingScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('publicPortal').classList.remove('hidden');
            
            loadPublicPortalData();
        }

        async function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const isLogin = document.getElementById('authButtonText').textContent === 'Entrar';
            
            showLoading('authSpinner', 'authButtonText');
            
            try {
                if (DEMO_MODE) {
                    // Demo mode - simulate authentication
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const userData = {
                        id: 'demo-user-' + Date.now(),
                        email: email,
                        created_at: new Date().toISOString()
                    };
                    
                    localStorage.setItem('belezatech_user', JSON.stringify(userData));
                    currentUser = userData;
                    
                    // Check if this is a new user (no salon data)
                    const existingSalon = localStorage.getItem('belezatech_salon');
                    if (!existingSalon) {
                        showOnboarding();
                    } else {
                        currentSalon = JSON.parse(existingSalon);
                        showDashboard();
                    }
                } else {
                    // Real Supabase authentication
                    let result;
                    if (isLogin) {
                        result = await supabase.auth.signInWithPassword({ email, password });
                    } else {
                        result = await supabase.auth.signUp({ email, password });
                    }
                    
                    if (result.error) {
                        throw result.error;
                    }
                    
                    currentUser = result.data.user;
                    localStorage.setItem('belezatech_user', JSON.stringify(currentUser));
                    
                    // Check if salon exists
                    const { data: salon } = await supabase
                        .from('salons')
                        .select('*')
                        .eq('user_id', currentUser.id)
                        .single();
                    
                    if (salon) {
                        currentSalon = salon;
                        localStorage.setItem('belezatech_salon', JSON.stringify(salon));
                        showDashboard();
                    } else {
                        showOnboarding();
                    }
                }
            } catch (error) {
                console.error('Authentication error:', error);
                alert('Erro na autentica√ß√£o: ' + error.message);
            } finally {
                hideLoading('authSpinner', 'authButtonText');
            }
        }

        function toggleAuthMode() {
            const button = document.getElementById('authButtonText');
            const link = document.getElementById('toggleAuth');
            
            if (button.textContent === 'Entrar') {
                button.textContent = 'Cadastrar';
                link.textContent = 'J√° tem conta? Fa√ßa login';
            } else {
                button.textContent = 'Entrar';
                link.textContent = 'N√£o tem conta? Cadastre-se';
            }
        }

        // Onboarding functions
        function nextOnboardingStep() {
            if (currentStep < 3) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                updateOnboardingButtons();
            }
        }

        function prevOnboardingStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                updateOnboardingButtons();
            }
        }

        function updateOnboardingButtons() {
            const prevBtn = document.getElementById('prevStep');
            const nextBtn = document.getElementById('nextStep');
            const finishBtn = document.getElementById('finishOnboarding');
            
            prevBtn.style.display = currentStep === 1 ? 'none' : 'inline-block';
            nextBtn.style.display = currentStep === 3 ? 'none' : 'inline-block';
            finishBtn.style.display = currentStep === 3 ? 'inline-block' : 'none';
        }

        async function finishOnboarding() {
            const salonData = {
                user_id: currentUser.id,
                name: document.getElementById('salonName').value,
                phone: document.getElementById('salonPhone').value,
                address: document.getElementById('salonAddress').value,
                open_time: document.getElementById('openTime').value,
                close_time: document.getElementById('closeTime').value,
                logo: document.getElementById('logoUpload').files[0] ? 
                      await convertFileToBase64(document.getElementById('logoUpload').files[0]) : null,
                primary_color: selectedColor,
                created_at: new Date().toISOString()
            };

            // Collect services
            const services = [];
            document.querySelectorAll('.service-item').forEach(item => {
                const inputs = item.querySelectorAll('input');
                if (inputs[0].value && inputs[1].value && inputs[2].value) {
                    services.push({
                        name: inputs[0].value,
                        price: parseFloat(inputs[1].value),
                        duration: parseInt(inputs[2].value),
                        active: true
                    });
                }
            });

            try {
                if (DEMO_MODE) {
                    // Demo mode
                    salonData.id = 'demo-salon-' + Date.now();
                    localStorage.setItem('belezatech_salon', JSON.stringify(salonData));
                    localStorage.setItem('belezatech_services', JSON.stringify(services));
                    currentSalon = salonData;
                } else {
                    // Real Supabase save
                    const { data: salon, error } = await supabase
                        .from('salons')
                        .insert([salonData])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    currentSalon = salon;
                    localStorage.setItem('belezatech_salon', JSON.stringify(salon));
                    
                    // Save services
                    if (services.length > 0) {
                        const servicesWithSalonId = services.map(service => ({
                            ...service,
                            salon_id: salon.id
                        }));
                        
                        await supabase
                            .from('services')
                            .insert(servicesWithSalonId);
                    }
                }
                
                showDashboard();
            } catch (error) {
                console.error('Error saving salon:', error);
                alert('Erro ao salvar dados do sal√£o: ' + error.message);
            }
        }

        function handleLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = `<img src="${e.target.result}" alt="Logo Preview" style="max-width: 150px; border-radius: 8px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function addServiceRow() {
            const servicesList = document.getElementById('servicesList');
            const newService = document.createElement('div');
            newService.className = 'service-item border rounded p-3 mb-3';
            newService.innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <input type="text" class="form-control" placeholder="Nome do servi√ßo">
                    </div>
                    <div class="col-3">
                        <input type="number" class="form-control" placeholder="Pre√ßo">
                    </div>
                    <div class="col-3">
                        <input type="number" class="form-control" placeholder="Dura√ß√£o (min)">
                    </div>
                </div>
            `;
            servicesList.appendChild(newService);
        }

        function selectColor(e) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            e.target.classList.add('selected');
            selectedColor = e.target.dataset.color;
            updateColorPreview();
        }

        function handleCustomColor(e) {
            selectedColor = e.target.value;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            updateColorPreview();
        }

        function updateColorPreview() {
            const preview = document.getElementById('colorPreview');
            const button = preview.querySelector('.btn-primary');
            button.style.backgroundColor = selectedColor;
            button.style.borderColor = selectedColor;
        }

        // Dashboard functions
        function handleNavigation(e) {
            e.preventDefault();
            
            const section = e.target.dataset.section;
            
            // Update active nav
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show section
            document.querySelectorAll('.section').forEach(sec => {
                sec.style.display = 'none';
            });
            document.getElementById(section + '-section').style.display = 'block';
            
            // Load section specific data
            switch(section) {
                case 'agenda':
                    loadCalendar();
                    break;
                case 'clients':
                    loadClients();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'stock':
                    loadProducts();
                    break;
                case 'payments':
                    loadPayments();
                    break;
            }
        }

        function loadDashboardData() {
            // Load KPIs
            updateKPIs();
            
            // Load revenue chart
            loadRevenueChart();
            
            // Load AI insights
            loadAIInsights();
            
            // Load today's appointments
            loadTodayAppointments();
        }

        function updateKPIs() {
            // Demo data - in real app, this would come from your database
            const demoData = {
                totalRevenue: 'R$ 12.450',
                totalAppointments: 142,
                totalClients: 89,
                todayAppointments: 8
            };
            
            document.getElementById('totalRevenue').textContent = demoData.totalRevenue;
            document.getElementById('totalAppointments').textContent = demoData.totalAppointments;
            document.getElementById('totalClients').textContent = demoData.totalClients;
            document.getElementById('todayAppointments').textContent = demoData.todayAppointments;
        }

        function loadRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Demo data for the last 7 days
            const data = {
                labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom'],
                datasets: [{
                    label: 'Faturamento',
                    data: [850, 920, 1100, 680, 1200, 1450, 980],
                    borderColor: selectedColor,
                    backgroundColor: selectedColor + '20',
                    tension: 0.4
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        async function loadAIInsights() {
            const insightText = document.getElementById('aiInsightText');
            insightText.textContent = 'Carregando insights...';
            
            try {
                // Simulate AI insight generation
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const insights = [
                    'Sexta-feira √© seu dia mais lucrativo da semana com 23% do faturamento total.',
                    'Clientes que fazem escova retornam em m√©dia 15 dias. Considere uma campanha de reten√ß√£o.',
                    'O servi√ßo "Corte + Escova" tem a maior margem de lucro. Promova mais este combo.',
                    'Voc√™ tem 12% mais agendamentos este m√™s comparado ao anterior. Parab√©ns!',
                    'Hor√°rios entre 14h-16h t√™m baixa ocupa√ß√£o. Considere promo√ß√µes para estes per√≠odos.'
                ];
                
                const randomInsight = insights[Math.floor(Math.random() * insights.length)];
                insightText.textContent = randomInsight;
            } catch (error) {
                insightText.textContent = 'Erro ao carregar insights. Tente novamente.';
            }
        }

        function loadTodayAppointments() {
            const container = document.getElementById('todayAppointmentsList');
            
            // Demo appointments for today
            const appointments = [
                { time: '09:00', client: 'Maria Silva', service: 'Corte Feminino', status: 'confirmed' },
                { time: '10:30', client: 'Ana Costa', service: 'Escova + Hidrata√ß√£o', status: 'confirmed' },
                { time: '14:00', client: 'Juliana Santos', service: 'Colora√ß√£o', status: 'pending' },
                { time: '15:30', client: 'Carla Oliveira', service: 'Corte + Escova', status: 'confirmed' },
                { time: '17:00', client: 'Fernanda Lima', service: 'Manicure', status: 'pending' }
            ];
            
            if (appointments.length === 0) {
                container.innerHTML = '<p class="text-muted">Nenhum agendamento para hoje.</p>';
                return;
            }
            
            container.innerHTML = appointments.map(apt => `
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <div>
                        <strong>${apt.time}</strong> - ${apt.client}
                        <br><small class="text-muted">${apt.service}</small>
                    </div>
                    <span class="badge ${apt.status === 'confirmed' ? 'bg-success' : 'bg-warning'}">
                        ${apt.status === 'confirmed' ? 'Confirmado' : 'Pendente'}
                    </span>
                </div>
            `).join('');
        }

        function refreshDashboard() {
            updateKPIs();
            loadAIInsights();
            loadTodayAppointments();
        }

        // Calendar functions
        function loadCalendar() {
            const calendar = document.getElementById('calendar');
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            generateCalendar(year, month);
        }

        function generateCalendar(year, month) {
            const calendar = document.getElementById('calendar');
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            let calendarHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>${getMonthName(month)} ${year}</h5>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm" onclick="changeMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="changeMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="fw-bold text-center p-2 bg-light">Dom</div>
                    <div class="fw-bold text-center p-2 bg-light">Seg</div>
                    <div class="fw-bold text-center p-2 bg-light">Ter</div>
                    <div class="fw-bold text-center p-2 bg-light">Qua</div>
                    <div class="fw-bold text-center p-2 bg-light">Qui</div>
                    <div class="fw-bold text-center p-2 bg-light">Sex</div>
                    <div class="fw-bold text-center p-2 bg-light">S√°b</div>
            `;
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendarHTML += '<div class="calendar-day bg-light"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const appointments = getDayAppointments(year, month, day);
                calendarHTML += `
                    <div class="calendar-day" onclick="selectCalendarDay(${year}, ${month}, ${day})">
                        <div class="fw-bold">${day}</div>
                        ${appointments.map(apt => `<div class="appointment">${apt.time} ${apt.client}</div>`).join('')}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;
        }

        function getDayAppointments(year, month, day) {
            // Demo appointments - in real app, this would come from your database
            const demoAppointments = {
                [`${year}-${month + 1}-15`]: [
                    { time: '09:00', client: 'Maria' },
                    { time: '14:00', client: 'Ana' }
                ],
                [`${year}-${month + 1}-16`]: [
                    { time: '10:00', client: 'Julia' }
                ]
            };
            
            const dateKey = `${year}-${month + 1}-${day}`;
            return demoAppointments[dateKey] || [];
        }

        function getMonthName(month) {
            const months = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            return months[month];
        }

        function selectCalendarDay(year, month, day) {
            // Show appointment modal with selected date
            const modal = new bootstrap.Modal(document.getElementById('appointmentModal'));
            document.getElementById('appointmentDate').value = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            modal.show();
        }

        // Client management functions
        function loadClients() {
            const clientsList = document.getElementById('clientsList');
            
            // Demo clients data
            const clients = [
                {
                    id: 1,
                    name: 'Maria Silva',
                    phone: '(11) 99999-1111',
                    email: 'maria@email.com',
                    lastVisit: '2024-01-15',
                    totalVisits: 12
                },
                {
                    id: 2,
                    name: 'Ana Costa',
                    phone: '(11) 99999-2222',
                    email: 'ana@email.com',
                    lastVisit: '2024-01-14',
                    totalVisits: 8
                },
                {
                    id: 3,
                    name: 'Juliana Santos',
                    phone: '(11) 99999-3333',
                    email: 'juliana@email.com',
                    lastVisit: '2024-01-10',
                    totalVisits: 15
                }
            ];
            
            clientsList.innerHTML = clients.map(client => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <div class="client-avatar me-3">
                                    ${client.name.charAt(0)}
                                </div>
                                <div>
                                    <h6 class="mb-0">${client.name}</h6>
                                    <small class="text-muted">${client.phone}</small>
                                </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="fw-bold">${client.totalVisits}</div>
                                    <small class="text-muted">Visitas</small>
                                </div>
                                <div class="col-6">
                                    <div class="fw-bold">${formatDate(client.lastVisit)}</div>
                                    <small class="text-muted">√öltima visita</small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm me-2" onclick="viewClient(${client.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="scheduleForClient(${client.id})">
                                    <i class="fas fa-calendar-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadServices() {
            const servicesList = document.getElementById('servicesList');
            
            // Get services from localStorage or use demo data
            let services = [];
            const storedServices = localStorage.getItem('belezatech_services');
            
            if (storedServices) {
                services = JSON.parse(storedServices);
            } else {
                services = [
                    { id: 1, name: 'Corte Feminino', price: 50, duration: 60, active: true },
                    { id: 2, name: 'Corte Masculino', price: 30, duration: 30, active: true },
                    { id: 3, name: 'Escova', price: 35, duration: 45, active: true },
                    { id: 4, name: 'Hidrata√ß√£o', price: 45, duration: 60, active: true },
                    { id: 5, name: 'Colora√ß√£o', price: 120, duration: 120, active: true }
                ];
            }
            
            servicesList.innerHTML = services.map(service => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h6 class="mb-0">${service.name}</h6>
                                <span class="badge ${service.active ? 'bg-success' : 'bg-secondary'}">
                                    ${service.active ? 'Ativo' : 'Inativo'}
                                </span>
                            </div>
                            <div class="row text-center mb-3">
                                <div class="col-6">
                                    <div class="fw-bold text-primary">R$ ${service.price}</div>
                                    <small class="text-muted">Pre√ßo</small>
                                </div>
                                <div class="col-6">
                                    <div class="fw-bold">${service.duration} min</div>
                                    <small class="text-muted">Dura√ß√£o</small>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary btn-sm flex-fill" onclick="editService(${service.id})">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteService(${service.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadProducts() {
            const productsList = document.getElementById('productsList');
            
            // Demo products
            const products = [
                {
                    id: 1,
                    name: 'Shampoo Hidratante Profissional',
                    category: 'shampoo',
                    quantity: 5,
                    barcode: '7891234567890',
                    description: 'Shampoo hidratante para cabelos ressecados'
                },
                {
                    id: 2,
                    name: 'Condicionador Nutritivo',
                    category: 'conditioner',
                    quantity: 3,
                    barcode: '7891234567891',
                    description: 'Condicionador nutritivo para todos os tipos de cabelo'
                },
                {
                    id: 3,
                    name: 'Tintura Permanente Castanho',
                    category: 'coloracao',
                    quantity: 8,
                    barcode: '7891234567892',
                    description: 'Tintura permanente cor castanho m√©dio'
                }
            ];
            
            productsList.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-1">${product.name}</h6>
                        <span class="badge bg-primary">${product.category}</span>
                    </div>
                    <p class="text-muted small mb-2">${product.description}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Qtd: ${product.quantity}</strong>
                            ${product.quantity <= 3 ? '<span class="badge bg-warning ms-2">Estoque Baixo</span>' : ''}
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary btn-sm" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPayments() {
            const transactionsTable = document.getElementById('transactionsTable');
            
            // Demo transactions
            const transactions = [
                {
                    date: '2024-01-15',
                    client: 'Maria Silva',
                    service: 'Corte Feminino',
                    amount: 50,
                    status: 'paid'
                },
                {
                    date: '2024-01-15',
                    client: 'Ana Costa',
                    service: 'Escova + Hidrata√ß√£o',
                    amount: 80,
                    status: 'paid'
                },
                {
                    date: '2024-01-14',
                    client: 'Juliana Santos',
                    service: 'Colora√ß√£o',
                    amount: 120,
                    status: 'pending'
                }
            ];
            
            transactionsTable.innerHTML = transactions.map(transaction => `
                <tr>
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.client}</td>
                    <td>${transaction.service}</td>
                    <td>R$ ${transaction.amount.toFixed(2)}</td>
                    <td>
                        <span class="badge ${transaction.status === 'paid' ? 'bg-success' : 'bg-warning'}">
                            ${transaction.status === 'paid' ? 'Pago' : 'Pendente'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Update payment metrics
            const totalToday = transactions
                .filter(t => t.date === '2024-01-15' && t.status === 'paid')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalPending = transactions
                .filter(t => t.status === 'pending')
                .reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('todayRevenue').textContent = `R$ ${totalToday.toFixed(2)}`;
            document.getElementById('pendingPayments').textContent = `R$ ${totalPending.toFixed(2)}`;
            document.getElementById('monthRevenue').textContent = 'R$ 2.450,00';
        }

        // Modal save functions
        function saveAppointment() {
            // Get form data
            const appointmentData = {
                client: document.getElementById('appointmentClient').value,
                service: document.getElementById('appointmentService').value,
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                notes: document.getElementById('appointmentNotes').value
            };
            
            // Validate
            if (!appointmentData.client || !appointmentData.service || !appointmentData.date || !appointmentData.time) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // Save to localStorage (demo)
            const appointments = JSON.parse(localStorage.getItem('belezatech_appointments') || '[]');
            appointments.push({
                id: Date.now(),
                ...appointmentData,
                created_at: new Date().toISOString()
            });
            localStorage.setItem('belezatech_appointments', JSON.stringify(appointments));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
            modal.hide();
            
            // Clear form
            document.getElementById('appointmentForm').reset();
            
            // Refresh calendar if on agenda section
            if (document.getElementById('agenda-section').style.display !== 'none') {
                loadCalendar();
            }
            
            alert('Agendamento salvo com sucesso!');
        }

        function saveClient() {
            const clientData = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                birthdate: document.getElementById('clientBirthdate').value,
                notes: document.getElementById('clientNotes').value
            };
            
            if (!clientData.name || !clientData.phone) {
                alert('Nome e telefone s√£o obrigat√≥rios.');
                return;
            }
            
            // Save to localStorage (demo)
            const clients = JSON.parse(localStorage.getItem('belezatech_clients') || '[]');
            clients.push({
                id: Date.now(),
                ...clientData,
                created_at: new Date().toISOString()
            });
            localStorage.setItem('belezatech_clients', JSON.stringify(clients));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('clientModal'));
            modal.hide();
            document.getElementById('clientForm').reset();
            
            if (document.getElementById('clients-section').style.display !== 'none') {
                loadClients();
            }
            
            alert('Cliente salvo com sucesso!');
        }

        function saveService() {
            const serviceData = {
                name: document.getElementById('serviceName').value,
                price: parseFloat(document.getElementById('servicePrice').value),
                duration: parseInt(document.getElementById('serviceDuration').value),
                description: document.getElementById('serviceDescription').value,
                active: document.getElementById('serviceActive').checked
            };
            
            if (!serviceData.name || !serviceData.price || !serviceData.duration) {
                alert('Nome, pre√ßo e dura√ß√£o s√£o obrigat√≥rios.');
                return;
            }
            
            // Save to localStorage (demo)
            const services = JSON.parse(localStorage.getItem('belezatech_services') || '[]');
            services.push({
                id: Date.now(),
                ...serviceData
            });
            localStorage.setItem('belezatech_services', JSON.stringify(services));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('serviceModal'));
            modal.hide();
            document.getElementById('serviceForm').reset();
            
            if (document.getElementById('services-section').style.display !== 'none') {
                loadServices();
            }
            
            alert('Servi√ßo salvo com sucesso!');
        }

        function saveProduct() {
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                quantity: parseInt(document.getElementById('productQuantity').value),
                barcode: document.getElementById('productBarcode').value,
                description: document.getElementById('productDescription').value
            };
            
            if (!productData.name || !productData.category || !productData.quantity) {
                alert('Nome, categoria e quantidade s√£o obrigat√≥rios.');
                return;
            }
            
            // Save to localStorage (demo)
            const products = JSON.parse(localStorage.getItem('belezatech_products') || '[]');
            products.push({
                id: Date.now(),
                ...productData
            });
            localStorage.setItem('belezatech_products', JSON.stringify(products));
            
            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
            modal.hide();
            document.getElementById('productForm').reset();
            
            if (document.getElementById('stock-section').style.display !== 'none') {
                loadProducts();
            }
            
            alert('Produto salvo com sucesso!');
        }

        // AI functions
        async function generateProductDescription() {
            const productName = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            
            if (!productName || !category) {
                alert('Preencha o nome e categoria do produto primeiro.');
                return;
            }
            
            const button = document.getElementById('generateDescription');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando...';
            
            try {
                // Simulate AI description generation
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const descriptions = {
                    shampoo: `${productName} √© um shampoo profissional desenvolvido para limpeza suave e eficaz. Sua f√≥rmula avan√ßada remove impurezas sem ressecar os fios, mantendo a hidrata√ß√£o natural do cabelo.`,
                    conditioner: `${productName} √© um condicionador nutritivo que proporciona maciez e brilho intensos. Sua textura cremosa facilita o desembara√ßo e protege contra danos externos.`,
                    coloracao: `${productName} √© uma colora√ß√£o profissional de alta performance que garante cobertura uniforme e cor duradoura. F√≥rmula enriquecida com ingredientes que protegem a fibra capilar.`,
                    tratamento: `${productName} √© um tratamento intensivo que repara e fortalece os cabelos danificados. Sua a√ß√£o profunda restaura a vitalidade e elasticidade natural dos fios.`
                };
                
                const description = descriptions[category] || `${productName} √© um produto profissional de alta qualidade para sal√µes de beleza.`;
                document.getElementById('productDescription').value = description;
                
            } catch (error) {
                alert('Erro ao gerar descri√ß√£o. Tente novamente.');
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-robot"></i> Gerar com IA';
            }
        }

        // Public portal functions
        function loadPublicPortalData() {
            if (currentSalon) {
                document.getElementById('publicSalonName').textContent = currentSalon.name;
                if (currentSalon.logo) {
                    const logoImg = document.getElementById('publicLogo');
                    logoImg.src = currentSalon.logo;
                    logoImg.style.display = 'inline';
                }
                
                // Apply salon colors
                applyBrandColors(currentSalon.primary_color);
                
                // Load services for booking
                loadPublicServices();
                
                // Set minimum date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('publicBookingDate').min = today;
            }
        }

        function loadPublicServices() {
            const select = document.getElementById('publicServiceSelect');
            const services = JSON.parse(localStorage.getItem('belezatech_services') || '[]');
            
            select.innerHTML = '<option value="">Escolha um servi√ßo...</option>';
            services.filter(service => service.active).forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = `${service.name} - R$ ${service.price} (${service.duration}min)`;
                select.appendChild(option);
            });
        }

        function handlePublicBooking(e) {
            e.preventDefault();
            
            const selectedTime = document.getElementById('selectedTimeSlot').value;
            
            const bookingData = {
                service: document.getElementById('publicServiceSelect').value,
                date: document.getElementById('publicBookingDate').value,
                time: selectedTime,
                name: document.getElementById('publicClientName').value,
                phone: document.getElementById('publicClientPhone').value,
                email: document.getElementById('publicClientEmail').value
            };
            
            // Validate required fields
            if (!bookingData.service || !bookingData.date || !bookingData.time || 
                !bookingData.name || !bookingData.phone) {
                alert('Por favor, preencha todos os campos obrigat√≥rios e selecione um hor√°rio.');
                return;
            }
            
            // Save booking
            const bookings = JSON.parse(localStorage.getItem('belezatech_public_bookings') || '[]');
            bookings.push({
                id: Date.now(),
                ...bookingData,
                status: 'pending',
                created_at: new Date().toISOString()
            });
            localStorage.setItem('belezatech_public_bookings', JSON.stringify(bookings));
            
            alert('Agendamento realizado com sucesso! Entraremos em contato para confirma√ß√£o.');
            document.getElementById('publicBookingForm').reset();
            document.getElementById('publicTimeSlots').innerHTML = '';
        }

        function copyPublicLink() {
            const link = document.getElementById('publicPortalLink').value;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copiado para a √°rea de transfer√™ncia!');
            });
        }

        function previewPublicPortal() {
            showPublicPortal();
        }

        // Utility functions
        function showLoading(spinnerId, textId) {
            document.getElementById(spinnerId).classList.remove('d-none');
            if (textId) {
                document.getElementById(textId).style.opacity = '0.6';
            }
        }

        function hideLoading(spinnerId, textId) {
            document.getElementById(spinnerId).classList.add('d-none');
            if (textId) {
                document.getElementById(textId).style.opacity = '1';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function applyBrandColors(color) {
            if (!color) return;
            
            const root = document.documentElement;
            root.style.setProperty('--primary-color', color);
            
            // Update charts and other elements
            setTimeout(() => {
                if (document.getElementById('revenueChart')) {
                    loadRevenueChart();
                }
            }, 100);
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            alert('Copiado para a √°rea de transfer√™ncia!');
        }

        function logout() {
            localStorage.removeItem('belezatech_user');
            localStorage.removeItem('belezatech_salon');
            currentUser = null;
            currentSalon = null;
            showAuth();
        }

        // Placeholder functions for future implementation
        function viewClient(id) { alert('Visualizar cliente ' + id); }
        function scheduleForClient(id) { alert('Agendar para cliente ' + id); }
        function editService(id) { alert('Editar servi√ßo ' + id); }
        function deleteService(id) { alert('Excluir servi√ßo ' + id); }
        function editProduct(id) { alert('Editar produto ' + id); }
        function deleteProduct(id) { alert('Excluir produto ' + id); }
        function changeMonth(direction) { alert('Mudar m√™s: ' + direction); }
    </script>
</body>
</html>

